@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

title C4 Maintancence Diagram - Learning Management System (LMS)

' Определение участников
Person(sys_admin, "Системный администратор", "Отвечает за работу и обслуживание системы")
Person(developer, "Разработчик", "Разрабатывает и поддерживает код приложения")

System_Boundary(kubernetes_boundary, "Кластер Kubernetes") {
    Container(docker_registry, "Регистри контейнеров", "GitLab Container Registry", "Хранит Docker-образы")
    Container(ci_cd_prod, "CI/CD Pipeline (PROD)", "GitLab CI/CD", "Пайплайн для продакшен-окружения")
    Container(ci_cd_dev, "CI/CD Pipeline (DEV)", "GitLab CI/CD", "Пайплайн для дев-окружения")
    Container(k8s_cluster, "Kubernetes Cluster", "Яндекс.Облако Kubernetes", "Хостит контейнеры приложения")
    Container(monitoring_service, "Система мониторинга", "Prometheus/Grafana", "Отслеживает состояние системы")
    Container(backup_service, "Система бэкапов", "Velero", "Создает и восстанавливает бэкапы")
}

System_Ext(mail_service, "Почтовый сервис", "SMTP", "Отправляет уведомления по Email")
System_Ext(vcs, "Система контроля версий", "GitLab", "Хранит исходный код")
System_Ext(notification_channel, "Канал уведомлений", "Slack/Email", "Получает уведомления от системы мониторинга")

' Взаимодействия

Rel(developer, vcs, "Коммит и push кода")
Rel(vcs, ci_cd_dev, "Триггерит CI/CD пайплайн для DEV")
Rel(vcs, ci_cd_prod, "Триггерит CI/CD пайплайн для PROD")

Rel(ci_cd_dev, docker_registry, "Сборка и push Docker-образов (dev)")
Rel(ci_cd_prod, docker_registry, "Сборка и push Docker-образов (prod)")

Rel(docker_registry, k8s_cluster, "Деплой Docker-образов")

Rel(sys_admin, monitoring_service, "Мониторит состояние системы")
Rel(monitoring_service, notification_channel, "Отправляет уведомления")
Rel(monitoring_service, k8s_cluster, "Собирает метрики")

Rel(sys_admin, backup_service, "Управляет бэкапами")
Rel(backup_service, k8s_cluster, "Создает и восстанавливает бэкапы")

Rel(notification_channel, sys_admin, "Получает уведомления")

@enduml
